<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>JSKhan FrameWork</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/img/icon.png" />
    <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/PauloSergioRomaoJunior/JSKhanFramework/master/assets/css/fonte.css">
    <link rel="stylesheet" href="assets/css/bootstrap.css">
    <style>
        .yell {
            background: transparent;
            /*background: rgba(241, 195, 9, 0.84) !important;
        */
        }
        
        [khan-txt-animate]>p {
            font-size: 30px !important;
        }
        
        [khan-txt-animate]>p.khan-txt-animate-mark {
            margin-left: 15px !important;
            font-weight: bold;
            color: #2c3e50;
            animation: 1s mark;
            animation-iteration-count: infinite;
        }
        
        @keyframes mark {
            0% {
                color: transparent;
                transition: .5s all
            }
            100% {
                color: rgba(0, 0, 0, 0.79);
                transition: .5s all
            }
        }
    </style>
</head>
<body>

    <template-khan>
        <!-- <h1 onclick="{{helloWorldMsg}}">{{Msg_Boas_Vindas}}</h1> -->
    </template-khan>
    
    <script type='text/javascript' src="//wurfl.io/wurfl.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/PauloSergioRomaoJunior/JSKhanFramework/master/lib/Routes/route.js?version=1.0.1"></script>
    <script type="text/javascript" charset="utf-8" src="scripts/app.js"></script>
    <script type="text/javascript" charset="utf-8" async>
        
        // new Khan(' nome do khan-app ');
        
        const App = new Khan('MeuApp'),
              Template = document.querySelector('template-khan');

        App.ConfigModules({
            "baseUrl": "lib/",
            "map": {
                "Log": "Modules/log",
                "Calculadora": "Modules/foo",
                "Foo": "Modules/foo",
                "Components": "Modules/Component",
                "Sockets": "Sockets/lib/cloud.min"
            }
        });

        App.Modules(["Components","Sockets"], function() {

                // ROUTE 1 INDEX
                App.Controllers('homeController', function($scope){

                    /*
                    App.Components().New('img-khan', {

                            init(){
                                console.log("Construtor do Component Img Khan");
                            },
                            dateCreate: new Date(),
                            get createAs(){
                                return this.dateCreate;
                            } 

                    });

                    console.log($scope);
                    console.log(App.Components().Create('img-khan'));
                    */

                    const Model = {

                        HelloWorld: "Ola Mundo !!",
                        Msg: "Chamado Pela viewController",
                        Msg_Boas_Vindas: "OlÃ¡ Seja bem Vindoooo",
                        helloWorldMsg(){
                           return  alert("Ola Mundo !! :)");
                        }

                    };

                    const Controlador = $scope;
                    Controlador.prototype.init = function(){
                        console.log("Construtor !!");
                    };

                    const Conn = new Controlador();
                    Conn.Render(Model);

                });

                // ROUTE 2
                App.Router('/page/:id', ($request) => {
                    App.DomRender(`<h1> Pagina ${$request}</h1>`);
                });

                App.Controllers('socketsController', function($scope){

                    function genId(){
                        if(sessionStorage.getItem('id')){
                            return sessionStorage.getItem('id');
                        }else{
                            sessionStorage.setItem('id', Math.floor(Math.random() * 100000));
                            Post(PATH + "teste.php",{
                                "Dispositivo": Dispositive,
                                "id": sessionStorage.getItem('id')
                            }, function(e){
                                console.log(e);
                            });
                        }
                    }

                    const PATH = "views/sockets/",
                          Dispositive = WURFL.form_factor,
                          ID = genId(),
                          CloudAws = new Cloud("api-youtube");
                    window.DataReceive = {};

                    App.PageRender(PATH + 'index.html', (c) => {
                        App.DomRender(c);
                    });
                    App.PageRender(PATH + 'mobile.html', (c) => {
                        App.DomRender(c);
                    });

                    CloudAws.event("connect", function(data){
                        setTimeout(() => {
                            $(".connect-input").value = sessionStorage.getItem('id');
                        }, Math.floor(Math.random() * 10000));
                    });

                    CloudAws.event("on", function(data){
                        var receive = JSON.parse(data);
                        receive.map((v) => {
                            var id = v.id;
                            if(Object.values(DataReceive).indexOf(id) == -1) DataReceive[id] = v;
                            if(Object.values(DataReceive).indexOf(id) != -1 && v.dispositivo != DataReceive[id].dispositivo){
                                alert("Conectado !!!");
                            }
                        });
                    });

                });

        });
    </script>
    <!-- <script type="text/javascript" charset="utf-8" src="lib/Cache/cache.js"></script> -->
</body>
</html>
